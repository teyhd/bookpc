<div class="space-y-6">
  <div class="glass-panel rounded-2xl border border-border/80 p-6 shadow-glow">
    <p class="text-xs uppercase tracking-[0.2em] text-slate-400">команды</p>
    <h4 class="mt-2 text-2xl font-semibold text-slate-50">Удалённое управление</h4>
    <p class="mt-3 text-sm text-slate-400">Отмечайте нужные устройства и запускайте команды одним кликом.</p>
    <div class="mt-5 grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-5">
      {{#each cmd}}
        <button class="cmdsf rounded-lg border border-border/80 bg-white/5 px-3 py-2 text-sm font-semibold text-slate-100 transition hover:border-brand hover:bg-brand/10 hover:text-white" comd="{{@index}}">
          {{this}}
        </button>
      {{/each}}
    </div>
  </div>

  <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-3">
    {{#each laps}}
      <label class="glass-panel block rounded-2xl border border-border/80 p-4 shadow-glow transition hover:border-brand/70">
        <div class="flex items-start justify-between gap-3">
          <div class="flex items-center gap-3">
            <input type="checkbox" class="pcinp h-5 w-5 rounded border-border/80 bg-[#0b1120] text-brand focus:ring-brand/60" name="d{{lapid}}" value="{{lapid}}">
            <div>
              <p class="text-xs uppercase tracking-[0.15em] text-slate-400">ID {{lapid}}</p>
              <p class="text-lg font-semibold text-slate-50" id="host_{{lapid}}">{{host}}</p>
            </div>
          </div>
          <span class="text-xs text-slate-400" id="times_{{lapid}}">{{times}}</span>
        </div>
        <div class="mt-4 space-y-2 text-sm text-slate-300">
          <div class="flex items-center justify-between">
            <span class="text-slate-400">IP</span>
            <span class="font-mono text-slate-100" id="ip_{{lapid}}">{{ip}}</span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-slate-400">Статус</span>
            <span class="text-slate-100" id="lock_{{lapid}}">{{lock}}</span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-slate-400">Команда</span>
            <span class="text-slate-100" id="cmd_{{lapid}}">{{cmd}}</span>
          </div>
        </div>
      </label>
    {{/each}}
  </div>
</div>

<script>
  let timerid = setInterval(inspect, 3000);

  function inspect(){
    $.get( `/lapchg` ).done(function( data ){
      try { data = JSON.parse(data); } catch(e) {}
      for (const sparam in data) {
        const el = document.getElementById(sparam);
        if (el) { el.textContent = data[sparam]; }
      }
    });
  }

  $('.cmdsf').click(function(){
    const checked = [];
    $('input:checkbox:checked').each(function() {
      checked.push($(this).val());
    });
    if (checked.length === 0){
      showToast('Выберите устройство для отправки команды', 'error');
      return 0;
    }

    $.get( `/sendcmd`, {cmd:$(this).attr('comd'),lapid:checked }).done(function( data ) {
      if (data=="ok"){
        showToast('Команда отправлена', 'success');
      } else {
        showToast('Не удалось отправить команду', 'error');
      }
    });
    inspect();
  });
</script>
